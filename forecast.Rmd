---
title: ""
output: html_document
fontsize: 12pt
---

```{r setup, include=FALSE}

options(scipen=999)

library(dplyr)
library(lubridate)
library(tidyr)
library(reshape2)
library(RCurl)
library(rvest)
library(ggplot2)
library(scales)
library(astsa)
library(ggthemes)
library(extrafont)
library(reshape)
library(car)
library(forecast)
library(fGarch)
library(highcharter)
library(dygraphs)
library(xts)
library(astsa)

#load data
emp.x <- getURL("https://raw.githubusercontent.com/brndngrhm/employment/master/formatted.emp.csv")
emp <- as.data.frame(read.csv(text = emp.x, strip.white = T))
emp[1] <- NULL
emp$date <- as.character(emp$date)
emp$date <-as.POSIXct(strptime(emp$date, format = "%Y-%m-%d"))
emp$month <- month(emp$date, label = T)
emp.ts <- ts(emp$jobs, frequency = 12)
emp.change <- diff(emp.ts)
date2 <- emp$date[1:195]

sp.x <- getURL("https://raw.githubusercontent.com/brndngrhm/employment/master/formatted.sp.csv")
sp <- as.data.frame(read.csv(text = sp.x, strip.white = T))
sp[1] <- NULL
sp$date <- as.character(sp$date)
sp$date <- ymd(sp$date)
sp$month <- month(sp$date, label = T)
sp.ts <- ts(sp$adj.close, frequency = 12)
sp.change <- diff(sp.ts)

manuf.x <- getURL("https://raw.githubusercontent.com/brndngrhm/employment/master/formatted.manuf.csv")
manuf <- as.data.frame(read.csv(text = manuf.x, strip.white = T))
manuf[1] <- NULL
manuf$date <- as.character(manuf$date)
manuf$date <- ymd(manuf$date)
manuf$month <- month(manuf$date, label = T)
manuf.ts <- ts(manuf$gacdfna, frequency = 12)
manuf.change <- diff(manuf.ts)

bai.x <- getURL("https://raw.githubusercontent.com/brndngrhm/employment/master/formatted.bai.csv")
bai <- as.data.frame(read.csv(text = bai.x, strip.white = T))
bai[1] <- NULL
bai$date <- as.character(bai$date)
bai$date <- ymd(bai$date)
bai$month <- month(bai$date, label = T)
bai.ts <- ts(bai$nmfbai, frequency = 12)
bai.change <- diff(bai.ts)

cpi.x <- getURL("https://raw.githubusercontent.com/brndngrhm/employment/master/formatted.cpi.csv")
cpi <- as.data.frame(read.csv(text = cpi.x, strip.white = T))
cpi[1] <- NULL
cpi$date <- as.character(cpi$date)
cpi$date <- ymd(cpi$date)
cpi$month <- month(cpi$date, label = T)
cpi.ts <- ts(cpi$cpi, frequency = 12)
cpi.change <- diff(cpi.ts)

starts.x <- getURL("https://raw.githubusercontent.com/brndngrhm/employment/master/formatted.starts.csv")
starts <- as.data.frame(read.csv(text = starts.x, strip.white = T))
starts[1] <- NULL
starts$date <- as.character(starts$date)
starts$date <- ymd(starts$date)
starts$month <- month(starts$date, label = T)
starts.ts <- ts(starts$starts, frequency = 12)
starts.change <- diff(starts.ts)


# highchart plotting paramaters
hc_params <- highchart() %>%
  hc_chart(zoomType = "x") %>%
  hc_tooltip(crosshairs = TRUE, shared = TRUE, borderWidth = 1, shared=T) %>%
  hc_yAxis(title=" ") %>%
  hc_exporting(enabled = TRUE) %>%
  hc_credits(enabled = TRUE,
             text = "BLS",
             href = "https://www.bls.gov/news.release/empsit.nr0.htm") %>% 
  hc_add_theme(hc_theme_gridlight()) %>%
  hc_legend(enabled = FALSE) %>%
  hc_subtitle(text="Since 2000", align="left") %>%
  hc_yAxis(title=" ")
alignment <- "left"  #subtitle alignment

```

# Forecasting the Monthly Change in US Non-Farm Payrolls {.tabset}

## Exploratory Plots 

Applying  various time series methods, I develop several models to try and forecast US monthly seasonally adjusted, non-farm payrolls. I first develop an arima model using the auto.arima function from the forecast package. Then I develop a SARIMA model using the astsa package where I fine tune the number of parameters to minimize the model's AIC. My third forecast is a regression model with ARMA errors using several covariates as leading indicators. My final forecast is a composite of the three models.

My composite forecast for May 2016 non-farm payrolls was 201,000 which was wildly incorrect - the actual May 2016 change in non-farm payrolls was 36,000. I plan to update the models on a rolling basis as each month's non-farm payrolls are released.
The most recent jobs report from the BLS can be found [here.](http://www.bls.gov/news.release/empsit.nr0.htm)

Before developing a forecast I want to look at a few plots:  

* A  time series plot of the raw numbers
* A time series plot of the change in jobs (since that's what I'm trying to forecast)
* An ACF & PACF plot to see the correlation structure

The prominent decrease in payrolls from about 2008 to 2010 show a lagged effect of the great recession (officially December 2007 to June 2009). The number of non farm payrolls have been increasing since about October of 2010.  
<p></br></p>

```{r, echo=F}
emp.xts <- xts(emp$jobs, order.by=emp$date, frequency=12)
hc_params %>% 
  highchart(type = "chart",height = 500) %>% 
   hc_add_series_xts(emp.xts, name = "Seasonally adjusted non-farm payrolls") %>%
  hc_title(text = "Seasonally Adjusted Non-Farm Payrolls", align = alignment)
```
<p></br></p>

```{r, echo = F}
emp.change.date <- as.data.frame(emp$date)
emp.change.date <- as.data.frame(emp.change.date[-1,])

change.emp.xts <- xts(emp.change, order.by=emp.change.date$`emp.change.date[-1, ]`, frequency=12)
```
<p></br></p>

The change in jobs also shows the effect of the great recession. Since the great recession, the average change in non-farm payrolls has been `r format(mean(change.emp.xts[114:195,]*1000), digits=2)`.  
<p></br></p>

```{r, echo=F}
emp.change.date <- as.data.frame(emp$date)
emp.change.date <- as.data.frame(emp.change.date[-1,])

change.emp.xts <- xts(emp.change, order.by=emp.change.date$`emp.change.date[-1, ]`, frequency=12)
#mean(change.emp.xts)

(emp.change.plot <- hc_params %>% 
  highchart(type = "chart", height = 500) %>% 
  hc_add_series_xts(change.emp.xts, name = "Monthly Change in US Employment (000s") %>%
  hc_title(text = "Monthly Change in US Employment (000s)", align = alignment) %>%
  hc_subtitle(text = "mean change in monthly jobs = 66,179", align = alignment) %>%
  hc_yAxis(plotLines = list(
           list(label = list(text = ""),
                color = "#CD2626",
                width = 2,
                value = 66.1))))
```
<p></br></p>

The ACF plot shows high correlation at large lags, suggesting the data is not stationary and differencing may be necessary.  
```{r, echo=F}

emp.acf <- acf2(emp.change, max.lag = 50)

``` 
<p></br></p>

The differenced data suggests an AR(1) model may be a good fit.

```{r, echo=F}

emp.acf.diff <-acf2(diff(emp.change))


```



## Covariates
In addition to some auto-regressive models, I tried develop a regression forecast using some leading indicators:

* Monthly S&P 500 closing prices from Yahoo [Finance](https://finance.yahoo.com/q/hp?s=%5EGSPC&a=00&b=1&c=2000&d=03&e=1&f=2016&g=m)
* Monthly Manufacturing general activity index from the [Phila. Fed](https://www.philadelphiafed.org/research-and-data/regional-economy/business-outlook-survey/historical-data)
* Monthly Non-manufacturing business activity index from the [Fed](https://research.stlouisfed.org/fred2/series/NMFBAI#)
* Monthly CPI-U from the [BLS](http://www.bls.gov/cpi/home.htm)
* Monthly housing starts from the [US Census](http://www.census.gov/construction/nrc/historical_data/index.html)



## The Forecast

## Me1thodology +  Sources
methodology + sources
different models, acf plots
